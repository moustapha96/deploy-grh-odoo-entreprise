import{O as z,m as C,n as x,U as s,j as e,P as k,R as h}from"./index-VSx_m0AV.js";import{r as o,h as L,L as S}from"./vendor-DvxF9bYu.js";import{o as E}from"./yup-CBYd5xIv.js";import{u as R}from"./resolvers-feI25x5d.js";import{T as b}from"./TextFormInput-ji-PqFYb.js";import{r as P}from"./loginService-Bjs3BML2.js";const I=()=>{const{urlApi:v}=o.useContext(z),i=L(),[n,c]=o.useState(!1),[l,m]=o.useState(!1),[a,d]=o.useState(0),y=C({email:x().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),code:x().required("Veuillez entrer le code").matches(/^\d{4}$/,"Le code doit contenir 4 chiffres")}),{control:u,handleSubmit:g,watch:T,reset:j,setValue:w,getValues:f}=R({resolver:E(y),defaultValues:{email:"",code:""}});o.useEffect(()=>{const r=new URLSearchParams(location.search).get("email");if(console.log(r),!r){s.error("Information utilisateur manquante. Veuillez vous inscrire à nouveau."),i("/auth/sign-up");return}w("email",r)},[location,i]),o.useEffect(()=>{if(a>0){const t=setTimeout(()=>d(a-1),1e3);return()=>clearTimeout(t)}},[a]);const N=async t=>{c(!0);try{const r=await fetch(`${v}partner/otp-verification`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log(r),!r.ok){const p=await r.json();console.error("Erreur de l'API :",p),s.error(p||"Erreur lors de la création du compte");return}s.success("Votre compte a été vérifié avec succès!"),j(),i("/auth/sign-in?mail="+t.email)}catch(r){console.error(r),s.error(res.message||"Le code de vérification est incorrect.")}finally{c(!1)}},V=async()=>{if(!(!email||a>0)){m(!0);try{const t=await P(email);console.log(t),s.success("Un nouveau code a été envoyé à votre adresse email."),d(60)}catch(t){console.error(t),s.error("Une erreur est survenue. Veuillez réessayer.")}finally{m(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Vérification de compte"}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Vérification de compte"}),e.jsx("p",{className:"mt-2 text-zinc-300",children:"Veuillez entrer le code à 4 chiffres que nous avons envoyé à votre adresse email."})]}),e.jsxs("form",{onSubmit:g(N),className:"mt-6 shrink",children:[e.jsx(b,{containerClassName:"mb-4",label:"Adresse email",name:"email",disabled:f("email"),labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",placeholder:"Entrez votre email",fullWidth:!0,control:u}),e.jsx(b,{containerClassName:"mb-4",label:"Code de vérification",name:"code",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0 text-center text-2xl tracking-widest",placeholder:"0000",maxLength:4,fullWidth:!0,control:u}),e.jsxs("div",{className:"mb-6 flex flex-col justify-center gap-4",children:[e.jsxs("button",{type:"submit",disabled:n,className:"relative inline-flex w-full items-center justify-center rounded bg-primary px-6 py-3 text-base capitalize text-white transition-all hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[n?"Vérification...":"Vérifier le compte",n&&e.jsx(h,{className:"ml-2 animate-spin"})]}),e.jsxs("button",{type:"button",onClick:V,disabled:l||a>0||!f("email"),className:"relative inline-flex w-full items-center justify-center rounded border border-white/20 bg-transparent px-6 py-3 text-base capitalize text-white/80 transition-all hover:bg-white/5 disabled:opacity-50 disabled:cursor-not-allowed",children:[l?"Envoi en cours...":a>0?`Renvoyer le code (${a}s)`:"Renvoyer le code",l&&e.jsx(h,{className:"ml-2 animate-spin"})]})]})]}),e.jsxs("p",{className:"shrink text-center text-zinc-200",children:["Retour à la",e.jsx(S,{to:"/auth/sign-in",className:"ms-1 text-primary",children:e.jsx("b",{children:"Connexion"})})]})]})};export{I as default};
