import{O as v,m as y,n as d,Q as g,j as e,P as N,W as P,U as r}from"./index-Bbm31QRN.js";import{r as o,h as k,f as z,L as C}from"./vendor-DvxF9bYu.js";import{o as S}from"./yup-CBYd5xIv.js";import{u as V}from"./resolvers-feI25x5d.js";import{P as u}from"./PasswordFormInput-DoJAa4B0.js";const O=()=>{const{urlApi:p}=o.useContext(v),f=k(),i=z(),[n,t]=o.useState(!1),[a,x]=o.useState("");o.useEffect(()=>{const s=new URLSearchParams(i.search).get("token");s&&x(s)},[i]);const b=y({newPassword:d().required("Veuillez entrer votre nouveau mot de passe"),confirmPassword:d().oneOf([g("newPassword")],"Les mots de passe doivent correspondre").required("Veuillez confirmer votre mot de passe")}),{control:l,handleSubmit:h,reset:w}=V({resolver:S(b),defaultValues:{newPassword:"",confirmPassword:""}}),j=async c=>{if(!a){r.error("Token de réinitialisation manquant. Veuillez demander un nouveau lien.");return}t(!0);try{const m=await(await fetch(`${p}api/new-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,password:c.newPassword})})).json();if(m.success){t(!1),r.success("Votre mot de passe a été réinitialisé avec succès!"),w(),setTimeout(()=>{f("/auth/sign-in")},2e3);return}t(!1),r.error(m.message||"Impossible de réinitialiser votre mot de passe. Veuillez réessayer.")}catch(s){console.error(s),t(!1),r.error("Une erreur est survenue. Veuillez réessayer.")}};return e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"Réinitialisation du mot de passe"}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Réinitialisation du mot de passe"}),e.jsx("p",{className:"mt-2 text-zinc-300",children:"Veuillez entrer votre nouveau mot de passe."})]}),!a&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-500/20 border border-yellow-500/50 rounded text-yellow-200 text-sm",children:"Token de réinitialisation manquant. Veuillez demander un nouveau lien de réinitialisation."}),e.jsxs("form",{onSubmit:h(j),className:"mt-6 shrink",children:[e.jsx(u,{label:"Nouveau mot de passe",containerClassName:"mb-4",name:"newPassword",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:l}),e.jsx(u,{label:"Confirmer le nouveau mot de passe",containerClassName:"mb-4",name:"confirmPassword",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:l}),e.jsx("div",{className:"mb-6 flex flex-col justify-center gap-4",children:e.jsxs("button",{type:"submit",disabled:n||!a,className:"relative inline-flex w-full items-center justify-center rounded bg-primary px-6 py-3 text-base capitalize text-white transition-all hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[n?"Réinitialisation...":"Réinitialiser le mot de passe",n&&e.jsx(P,{className:"ml-2 animate-spin"})]})})]}),e.jsxs("p",{className:"shrink text-center text-zinc-200",children:["Retour à la",e.jsx(C,{to:"/auth/sign-in",className:"ms-1 text-primary",children:e.jsx("b",{children:"Connexion"})})]})]})};export{O as default};
